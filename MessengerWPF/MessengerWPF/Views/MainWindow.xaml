<Window x:Class="ChatApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:ChatApp.ViewModels"
        xmlns:conv="clr-namespace:ChatApp.Converters"
        Title="Chat App" Height="600" Width="800" Background="#E3FCE7">

    <Window.Resources>
        <conv:NullToVisibilityConverter x:Key="NullToVisibility"/>
        <conv:NotNullToVisibilityConverter x:Key="NotNullToVisibility"/>
        <conv:NotNullMultiToVisibilityConverter x:Key="NotNullMultiToVisibility"/>
        <conv:NullMultiToVisibilityConverter x:Key="NullMultiToVisibility"/>
        <conv:BoolToAlignmentConverter x:Key="BoolToAlignmentConverter"/>
        <conv:BoolToTextAlignConverter x:Key="BoolToTextAlignConverter"/>
        <conv:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <conv:HideIfNicknameOrEmailAndPasswordConverter x:Key="HideIfNicknameOrEmailAndPassword"/>
        <conv:ShowIfNicknameOrEmailAndPasswordConverter x:Key="ShowIfNicknameOrEmailAndPassword"/>
    </Window.Resources>

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Текст с инструкцией -->
        <TextBlock FontSize="11"
           Padding="5"
           HorizontalAlignment="Left"
           Width="170" 
           Height="50"
           Margin="10, 300, 10, 10"
           Foreground="Red"
           TextAlignment="Center">
            <TextBlock.Visibility>
                <MultiBinding Converter="{StaticResource HideIfNicknameOrEmailAndPassword}">
                    <Binding Path="Nickname"/>
                    <Binding Path="Email"/>
                    <Binding Path="Password"/>
                </MultiBinding>
            </TextBlock.Visibility>

    <Run Text="Для отправки сообщений"/>
    <LineBreak/>
    <Run Text="необходимо указать никнейм"/>
    <LineBreak/>
    <Run Text="или авторизоваться"/>
        </TextBlock>

        <!-- Кнопка указания никнейма -->
        <Button Grid.Column="0"
                Content="Указать никнейм"
                Background="#F6B530"
                VerticalAlignment="Center"
                Margin="10, 400, 10, 10"
                Padding="5"
                Click="Nickname_Click">
            <Button.Visibility>
                <MultiBinding Converter="{StaticResource HideIfNicknameOrEmailAndPassword}">
                    <Binding Path="Nickname"/>
                    <Binding Path="Email"/>
                    <Binding Path="Password"/>
                </MultiBinding>
            </Button.Visibility>
        </Button>

        <!-- Кнопка авторизации -->
        <Button Grid.Column="0"
        Content="Авторизоваться"
        Background="#F6B530"
        Margin="10,470,10,10"
        Padding="5"
        VerticalAlignment="Center"
        Click="Auth_Click">
            <Button.Visibility>
                <MultiBinding Converter="{StaticResource NullMultiToVisibility}">
                    <Binding Path="Email" />
                    <Binding Path="Password" />
                </MultiBinding>
            </Button.Visibility>
        </Button>

        <!-- Левая панель -->
        <Border Background="#FFEED3"
        Grid.Column="0"
        Padding="5"
        Width="200"
        HorizontalAlignment="Left"
        VerticalAlignment="Top">
            <Border.Visibility>
                <MultiBinding Converter="{StaticResource ShowIfNicknameOrEmailAndPassword}">
                    <Binding Path="Nickname"/>
                    <Binding Path="Email"/>
                    <Binding Path="Password"/>
                </MultiBinding>
            </Border.Visibility>
            <StackPanel>

                <!-- Панель участников -->
                <StackPanel>
                    <StackPanel.Visibility>
                        <MultiBinding Converter="{StaticResource ShowIfNicknameOrEmailAndPassword}">
                            <Binding Path="Nickname"/>
                            <Binding Path="Email"/>
                            <Binding Path="Password"/>
                        </MultiBinding>
                    </StackPanel.Visibility>

                    <TextBlock Text="Участники" FontWeight="Bold" Margin="5"
                               Visibility="{Binding Nickname, Converter={StaticResource NotNullToVisibility}}"/>
                    <ListBox ItemsSource="{Binding Participants}" BorderThickness="0"
                     HorizontalContentAlignment="Stretch"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                     Height="Auto"
                     SelectedItem="{Binding SelectedParticipant}"
                     MouseDoubleClick="ParticipantsListBox_MouseDoubleClick">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#D7A5A5" Margin="3" Padding="5" CornerRadius="4">
                                    <TextBlock Text="{Binding UserName}"
                                               FontFamily="Jokerman"
                                               FontSize="16"
                                               Foreground="Black"
                                               FontWeight="Bold"/>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </StackPanel>

                <!-- Разделитель -->
                <Separator Margin="5" />

                <!-- Панель чатов -->
                <StackPanel>
                    <StackPanel.Visibility>
                        <MultiBinding Converter="{StaticResource NotNullMultiToVisibility}">
                            <Binding Path="Email"/>
                            <Binding Path="Password"/>
                        </MultiBinding>
                    </StackPanel.Visibility>

                    <TextBlock Text="Чаты" FontWeight="Bold" Margin="10 20 5 5"/>
                    <ListBox ItemsSource="{Binding Chats}" SelectedItem="{Binding SelectedChat}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding ChatName}" FontWeight="Bold"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </StackPanel>

            </StackPanel>
        </Border>

        <!-- Правая панель -->
        <Grid Grid.Column="1" Background="#FFEED3">
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Заголовок -->
            <TextBlock Text="Общий чат" FontSize="16" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" Background="#D3D3D3"/>

            <!-- Сообщения -->
            <ScrollViewer Grid.Row="1" Margin="10" VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding Messages}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{Binding IsOwnMessage, Converter={StaticResource BoolToColorConverter}}"
                Padding="10"
                Margin="5"
                CornerRadius="10"
                HorizontalAlignment="{Binding IsOwnMessage, Converter={StaticResource BoolToAlignmentConverter}}"
                MaxWidth="300">
                                <StackPanel>
                                    <TextBlock Text="{Binding Sender}"
                           FontWeight="Bold"
                           Foreground="Gray"
                           Margin="0,0,0,5"/>
                                    <TextBlock Text="{Binding Content}"
                           TextWrapping="Wrap"
                           FontSize="14"
                           Foreground="Black"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- Ввод -->
            <Grid Grid.Row="2" Height="60" Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0"
                         Text="{Binding MessageText, UpdateSourceTrigger=PropertyChanged}"
                         VerticalAlignment="Center"
                         Height="40"
                         Margin="0,0,10,0"
                         Background="#E8F4FF"
                         VerticalContentAlignment="Center"/>

                <Button Grid.Column="1"
                        Content="Ввод"
                        Width="80"
                        Background="#3AC4B3"
                        Foreground="White"
                        VerticalAlignment="Center"
                        Command="{Binding SendMessageCommand}"/>
            </Grid>
        </Grid>
    </Grid>
</Window>